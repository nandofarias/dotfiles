#!/bin/bash
# Wrapper for OpenClaw audio transcription via openai-whisper
# Uses full paths since LaunchAgent has a limited PATH
# stdout = plain transcript (required by OpenClaw)
FILE="$1"
echo "[whisper-transcribe] called with: $FILE" >> /tmp/whisper-transcribe.log 2>&1
BASENAME=$(basename "$FILE")
NOEXT="${BASENAME%.*}"
TMPDIR=$(mktemp -d)
/opt/homebrew/bin/whisper "$FILE" \
  --model base \
  --output_format txt \
  --output_dir "$TMPDIR" \
  >/dev/null 2>&1
RESULT=$(cat "$TMPDIR/$NOEXT.txt" 2>/dev/null)
echo "[whisper-transcribe] result: $RESULT" >> /tmp/whisper-transcribe.log 2>&1
echo "$RESULT"
rm -rf "$TMPDIR"
